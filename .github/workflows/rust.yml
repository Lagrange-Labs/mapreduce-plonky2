on:
  pull_request:
  push:
    branches:
      - main


name: Check, Test, and Format

jobs:
  fmt:
    name: Rustfmt
    runs-on: ubuntu-latest
    steps:
      - run: sudo apt-get update && sudo apt-get install -yq pkg-config libssl-dev
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v3
        with:
          go-version: ~1.20
      - uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: nightly-2024-05-17
          override: true
      - run: rustup component add rustfmt
      - uses: actions-rs/cargo@v1
        with:
          command: fmt
          args: --all -- --check

  check:
    name: Check
    runs-on: ubuntu-latest
    steps:
      - run: sudo apt-get update && sudo apt-get install -yq pkg-config libssl-dev
      - uses: actions/checkout@v2
      - uses: actions/setup-go@v3
        with:
          go-version: ~1.20
      - uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: nightly-2024-05-17
          override: true
      #       - uses: actions-rs/cargo@v1
      #         with:
      #           command: check
      # 
      #   test:
      #     name: Test Suite
      #     runs-on: nix-128g
      #     steps:
      #       - name: Checkout sources
      #         uses: actions/checkout@v4
      #       - name: Install foundry
      #         shell: devenv shell bash -- -e {0}
      #         run: cargo install --root ${HOME}/.cargo --git https://github.com/foundry-rs/foundry --rev c4a984f forge anvil
      #       - name: Put cargo in PATH
      #         shell: devenv shell bash -- -e {0}
      #         run: echo "${HOME}/.cargo/bin" >> $GITHUB_PATH
      #       - name: Run cargo test
      #         # run: devenv test
      #         run: echo "not running test on CI for this one"
      #         env:
      #           RUST_LOG: "info"
      #           RUST_MIN_STACK: 10485760
      #           CI_RPC_URL: ${{ secrets.CI_RPC_URL }}
      #           CI_SEPOLIA: ${{ secrets.CI_SEPOLIA }}
      #           CI_ETH: ${{ secrets.CI_ETH }}
